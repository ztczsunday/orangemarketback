(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5267352b"],{"1d9a":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("VanForm",{on:{submit:e.onSubmit}},[a("VanField",{attrs:{rules:[{required:!0,message:"请填写商品名"}],label:"商品名",name:"goodsName",placeholder:"商品名"},model:{value:e.goodsName,callback:function(t){e.goodsName=t},expression:"goodsName"}}),a("VanField",{attrs:{"is-link":"",label:"分类",name:"label",placeholder:"请选择您的商品分类",readonly:""},on:{click:function(t){e.show=!0}},model:{value:e.fieldValue,callback:function(t){e.fieldValue=t},expression:"fieldValue"}}),a("VanPopup",{attrs:{position:"bottom",round:""},model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[a("VanCascader",{attrs:{options:e.options,title:"请选择商品分类"},on:{close:function(t){e.show=!1},finish:e.onFinish},model:{value:e.cascaderValue,callback:function(t){e.cascaderValue=t},expression:"cascaderValue"}})],1),a("VanField",{attrs:{label:"商品图片上传",name:"uploader"},scopedSlots:e._u([{key:"input",fn:function(){return[a("VanUploader",{attrs:{"after-read":e.afterReadGoods,"before-delete":e.upLoaderDelete,"before-read":e.beforeRead,"max-count":5,multiple:"",name:"Uploader"},model:{value:e.uploader,callback:function(t){e.uploader=t},expression:"uploader"}})]},proxy:!0}])}),a("VanField",{attrs:{label:"商品主图上传",name:"uploaderSubDefault"},scopedSlots:e._u([{key:"input",fn:function(){return[a("VanUploader",{attrs:{"after-read":e.afterReadGoods,"before-delete":e.upLoaderDelete,"before-read":e.beforeRead,"max-count":1,multiple:"",name:"uploaderSubDefault"},model:{value:e.uploaderSubDefault,callback:function(t){e.uploaderSubDefault=t},expression:"uploaderSubDefault"}})]},proxy:!0}])}),a("VanField",{attrs:{label:"商品详情",name:"uploaderDetail"},scopedSlots:e._u([{key:"input",fn:function(){return[a("VanUploader",{attrs:{"after-read":e.afterReadGoods,"before-delete":e.upLoaderDelete,"before-read":e.beforeRead,"max-count":10,multiple:"",name:"UploaderDetail"},model:{value:e.uploaderDetail,callback:function(t){e.uploaderDetail=t},expression:"uploaderDetail"}})]},proxy:!0}])}),e._l(e.typeList,(function(t,n){return a("div",{key:n},[a("VanCell",{attrs:{"is-link":""},on:{click:function(t){return e.showPopup(n)}}},[e._v(e._s(t.subName))]),a("VanPopup",{style:{height:"70%"},attrs:{closeable:"",height:"700px",position:"bottom",round:""},model:{value:e.showSub[n],callback:function(t){e.$set(e.showSub,n,t)},expression:"showSub[i]"}},[a("div",{staticClass:"popBlock"},[e._v(" 您的品类 ")]),a("VanForm",{on:{submit:function(t){return e.upDateSub(n)}}},[a("VanField",{attrs:{rules:[{required:!0,message:"请填写子种类名"}],label:"子种类名",name:"subTypeName",placeholder:"子种类名"},model:{value:e.typeList[n].subName,callback:function(t){e.$set(e.typeList[n],"subName",t)},expression:"typeList[i].subName"}}),a("VanField",{attrs:{rules:[{required:!0,message:"请填写子种类单价"}],label:"子种类单价",name:"subTypePrice",placeholder:"子种类单价"},model:{value:e.typeList[n].subPrice,callback:function(t){e.$set(e.typeList[n],"subPrice",t)},expression:"typeList[i].subPrice"}}),a("VanField",{attrs:{rules:[{required:!0,message:"请填写子种类库存"}],label:"子种类库存",name:"subTypeStock",placeholder:"子种类库存"},model:{value:e.typeList[n].subStock,callback:function(t){e.$set(e.typeList[n],"subStock",t)},expression:"typeList[i].subStock"}}),a("VanField",{attrs:{label:"种类图标上传",name:"uploaderSub"},scopedSlots:e._u([{key:"input",fn:function(){return[a("VanUploader",{attrs:{"before-read":e.beforeRead,"max-count":1,multiple:""},model:{value:e.typeList[n].subPic,callback:function(t){e.$set(e.typeList[n],"subPic",t)},expression:"typeList[i].subPic"}})]},proxy:!0}],null,!0)}),a("div",{staticStyle:{margin:"16px"}},[a("VanButton",{attrs:{block:"","native-type":"submit",round:"",type:"info"}},[e._v("确认")]),a("ARow",{style:{height:"10px"}}),a("VanButton",{attrs:{block:"",round:"",type:"danger"},on:{click:function(t){return e.deleteSub(n)}}},[e._v("删除")])],1)],1)],1)],1)})),a("VanCell",{attrs:{"is-link":""},on:{click:e.showPopupAdd}},[e._v("新建子类")]),a("VanPopup",{style:{height:"70%"},attrs:{closeable:"",position:"bottom",round:""},model:{value:e.showAdd,callback:function(t){e.showAdd=t},expression:"showAdd"}},[a("div",{staticClass:"popBlock"},[e._v(" 新的子种类 ")]),a("VanForm",{on:{submit:e.addSub}},[a("VanField",{attrs:{rules:[{required:!0,message:"请填写子种类名"}],label:"子种类名",name:"subTypeName",placeholder:"子种类名"},model:{value:e.subTypeName,callback:function(t){e.subTypeName=t},expression:"subTypeName"}}),a("VanField",{attrs:{rules:[{required:!0,message:"请填写子种类单价"}],label:"子种类单价",name:"subTypePrice",placeholder:"子种类单价"},model:{value:e.subTypePrice,callback:function(t){e.subTypePrice=t},expression:"subTypePrice"}}),a("VanField",{attrs:{rules:[{required:!0,message:"请填写子种类库存"}],label:"子种类库存",name:"subTypeStock",placeholder:"子种类库存"},model:{value:e.subTypeStock,callback:function(t){e.subTypeStock=t},expression:"subTypeStock"}}),a("VanField",{attrs:{label:"种类图标上传",name:"uploaderSub"},scopedSlots:e._u([{key:"input",fn:function(){return[a("VanUploader",{attrs:{"before-read":e.beforeRead,"max-count":1,multiple:""},model:{value:e.uploaderSub,callback:function(t){e.uploaderSub=t},expression:"uploaderSub"}})]},proxy:!0}])}),a("div",{staticStyle:{margin:"16px"}},[a("VanButton",{attrs:{block:"","native-type":"submit",round:"",type:"info"}},[e._v("确认")])],1)],1)],1),a("div",{staticStyle:{margin:"16px"}},[a("VanButton",{attrs:{block:"","native-type":"submit",round:"",type:"info"}},[e._v("提交")])],1)],2)},o=[],r=a("1da1"),u=(a("96cf"),a("d3b7"),a("3ca3"),a("ddb0"),a("a9e3"),a("a15b"),a("d81d"),a("b0c0"),a("a434"),a("d399")),s={name:"BuildGoods",created:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){var n,o,r,u;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,a.e("chunk-4a8a29de").then(a.bind(null,"31ca"));case 2:return n=t.sent,o=n.$,t.next=6,o.get("/commodity/labels");case 6:for(r=t.sent,u=0;u<r.data.information.length;u++)e.options.push({text:r.data.information[u].itemName,value:r.data.information[u].recordId});case 8:case"end":return t.stop()}}),t)})))()},data:function(){return{type:String,cid:Number,label:[],uploader:[],uploaderName:[],uploaderSub:[],uploaderSubName:null,uploaderSubDefault:[],uploaderSubDefaultName:null,uploaderDetail:[],uploaderDetailName:[],goodsName:null,show:!1,fieldValue:"",cascaderValue:"",showSub:[!1],showAdd:!1,subTypeName:null,subTypePrice:null,subTypeStock:null,options:[],typeList:[],postList:[]}},methods:{onSubmit:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){var n,o,r,s,l,i,c,d,p;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:n=!0,o=0;case 2:if(!(o<e.typeList.length)){t.next=9;break}if(0!==e.typeList[o].subPic.length){t.next=6;break}return n=!1,t.abrupt("break",9);case 6:o++,t.next=2;break;case 9:if(0!==e.uploaderSubDefault.length){t.next=13;break}Object(u["a"])("缺少主图片"),t.next=39;break;case 13:if(0!==e.typeList.length){t.next=17;break}Object(u["a"])("至少设置一个种类"),t.next=39;break;case 17:if(!1!==n){t.next=21;break}Object(u["a"])("每个子种类都要有图片"),t.next=39;break;case 21:return r={headers:{"Content-Type":"application/json;charset=UTF-8"}},t.next=24,a.e("chunk-4a8a29de").then(a.bind(null,"31ca"));case 24:for(s=t.sent,l=s.$,i=0;i<e.options.length;i++)e.options[i].text===e.fieldValue&&e.label.push(e.options[i].value);for(c=0;c<e.typeList.length;c++)e.postList.push({cid:0,price:e.typeList[c].subPrice,stock:e.typeList[c].subStock,subCommodityStatus:!0,subIcon:e.typeList[c].subPicName,subId:0,subName:e.typeList[c].subName});return d={commodityDetails:e.uploaderDetailName,commodityName:e.goodsName,labelId:e.label,mainIcon:e.uploaderSubDefaultName,mainIcons:e.uploaderName,subCommodity:e.postList},t.next=31,l.post("/commodity",d,r);case 31:if(p=t.sent,!p.data.success){t.next=38;break}return Object(u["a"])("创建成功"),t.next=36,e.$router.push({name:"商铺管理"});case 36:t.next=39;break;case 38:Object(u["a"])("创建失败");case 39:case"end":return t.stop()}}),t)})))()},onFinish:function(e){var t=e.selectedOptions;this.show=!1,this.fieldValue=t.map((function(e){return e.text})).join("/")},beforeRead:function(e){return"image/jpeg"===e.type||(Object(u["a"])("请上传 jpg 格式图片"),!1)},showPopup:function(e){this.showSub[e]=!0,this.showAdd=!0,this.showAdd=!1},showPopupAdd:function(){this.showAdd=!0},addSub:function(e){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function n(){var o,r,s,l,i,c;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(0!==t.uploaderSub.length){n.next=4;break}Object(u["a"])("至少上传一个图片"),n.next=22;break;case 4:return o={headers:{"Content-Type":"multipart/form-data;boundary="+(new Date).getTime()}},n.next=7,a.e("chunk-4a8a29de").then(a.bind(null,"31ca"));case 7:return r=n.sent,s=r.$,l=new FormData,l.append("file",t.uploaderSub[0].file),n.next=13,s.post("/upload",l,o);case 13:i=n.sent,c={subName:e.subTypeName,subPrice:parseInt(e.subTypePrice),subStock:parseInt(e.subTypeStock),subPic:t.uploaderSub,subPicName:i.data.information},t.showSub.push(!1),t.typeList.push(c),t.showAdd=!1,t.uploaderSub=[],t.subTypeStock=null,t.subTypePrice=null,t.subTypeName=null;case 22:case"end":return n.stop()}}),n)})))()},upDateSub:function(e){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function n(){var o,r,s,l,i;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return o={headers:{"Content-Type":"multipart/form-data;boundary="+(new Date).getTime()}},n.next=3,a.e("chunk-4a8a29de").then(a.bind(null,"31ca"));case 3:return r=n.sent,s=r.$,l=new FormData,l.append("file",t.typeList[e].subPic[0].file),n.next=9,s.post("/upload",l,o);case 9:i=n.sent,t.typeList[e].subPicName=i.data.information,Object(u["a"])("修改成功"),t.showSub[e]=!1,t.showAdd=!0,t.showAdd=!1;case 15:case"end":return n.stop()}}),n)})))()},afterReadGoods:function(e,t){var n=this;return Object(r["a"])(regeneratorRuntime.mark((function o(){var r,u,s,l,i;return regeneratorRuntime.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return r={headers:{"Content-Type":"multipart/form-data;boundary="+(new Date).getTime()}},o.next=3,a.e("chunk-4a8a29de").then(a.bind(null,"31ca"));case 3:return u=o.sent,s=u.$,l=new FormData,l.append("file",e.file),o.next=9,s.post("/upload",l,r);case 9:i=o.sent,"Uploader"===t.name?n.uploaderName.push(i.data.information):"UploaderDetail"===t.name?n.uploaderDetailName.push(i.data.information):"uploaderSubDefault"===t.name&&(n.uploaderSubDefaultName=i.data.information);case 11:case"end":return o.stop()}}),o)})))()},upLoaderDelete:function(e){return"Uploader"===e.name?this.uploaderName.splice(e.index,1):"UploaderDetail"===e.name?this.uploaderDetailName.splice(e.index,1):"uploaderSubDefault"===e.name&&(this.uploaderSubDefaultName=null),Promise},deleteSub:function(e){this.typeList.splice(e,1),Object(u["a"])("删除成功"),this.showSub[e]=!1,this.showAdd=!0,this.showAdd=!1}}},l=s,i=(a("8b4a"),a("2877")),c=Object(i["a"])(l,n,o,!1,null,"338bb398",null);t["default"]=c.exports},3282:function(e,t,a){},"8b4a":function(e,t,a){"use strict";a("3282")},a15b:function(e,t,a){"use strict";var n=a("23e7"),o=a("44ad"),r=a("fc6a"),u=a("a640"),s=[].join,l=o!=Object,i=u("join",",");n({target:"Array",proto:!0,forced:l||!i},{join:function(e){return s.call(r(this),void 0===e?",":e)}})},a434:function(e,t,a){"use strict";var n=a("23e7"),o=a("23cb"),r=a("a691"),u=a("50c4"),s=a("7b0b"),l=a("65f0"),i=a("8418"),c=a("1dde"),d=c("splice"),p=Math.max,b=Math.min,m=9007199254740991,f="Maximum allowed length exceeded";n({target:"Array",proto:!0,forced:!d},{splice:function(e,t){var a,n,c,d,h,y,k=s(this),x=u(k.length),S=o(e,x),w=arguments.length;if(0===w?a=n=0:1===w?(a=0,n=x-S):(a=w-2,n=b(p(r(t),0),x-S)),x+a-n>m)throw TypeError(f);for(c=l(k,n),d=0;d<n;d++)h=S+d,h in k&&i(c,d,k[h]);if(c.length=n,a<n){for(d=S;d<x-n;d++)h=d+n,y=d+a,h in k?k[y]=k[h]:delete k[y];for(d=x;d>x-n+a;d--)delete k[d-1]}else if(a>n)for(d=x-n;d>S;d--)h=d+n-1,y=d+a-1,h in k?k[y]=k[h]:delete k[y];for(d=0;d<a;d++)k[d+S]=arguments[d+2];return k.length=x-n+a,c}})},a640:function(e,t,a){"use strict";var n=a("d039");e.exports=function(e,t){var a=[][e];return!!a&&n((function(){a.call(null,t||function(){throw 1},1)}))}}}]);